from pwn import *
from sympy import mod_inverse
from random import randrange

# Mude esta linha no seu exploit.py
host, port = "127.0.0.1", 4354

r = remote(host, port)

r.recvuntil(b"g: ")
g = int(r.recvline())
r.recvuntil(b"p: ")
p = int(r.recvline())
r.recvuntil(b"y: ")
y = int(r.recvline())

for round_num in range(257):
    r.recvuntil(b"Send")
    
    if round_num % 2 == 0:
        # Estrategia para rodadas PARES (Cenario 2 - O Truque)
        ran = randrange(p)
        y_inv = mod_inverse(y, p)
        C = (pow(g, ran, p) * y_inv) % p
        r.sendline(str(C))
        r.recvuntil(b"Send")
        r.sendline(str(ran))
    else:
        # Estrategia para rodadas IMPARES (Cenario 1 - O Facil)
        ran = randrange(p)
        C = pow(g, ran, p)
        r.sendline(str(C))
        r.recvuntil(b"Send")
        r.sendline(str(ran))
        
    print(f"Rodada {round_num} passada com sucesso!")

flag = r.recvall()
print("\n--- FLAG ---")
print(flag.decode())